<!DOCTYPE html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="" />
	
	
	
	<title>bloom filter ï½œ è¢«é—å¿˜çš„åšå®¢</title>
	
    
    
    <meta name="description" content="å½“ç³»ç»Ÿè®¾è®¡ä¸­å‡ºç°å¤šçº§ç¼“å­˜ç»“æ„æ—¶ï¼Œä¸ºäº†é˜²æ­¢å¤§é‡ä¸å­˜åœ¨çš„keyå€¼å‡»ç©¿é«˜é€Ÿç¼“å­˜ï¼ˆæ¯”å¦‚ä¸»å­˜ï¼‰ï¼Œå»ç›´æ¥è®¿é—®ä½é€Ÿç¼“å­˜ï¼ˆå¦‚æœ¬åœ°ç£ç›˜ï¼‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦å°†è¿™éƒ¨åˆ†keyå€¼ï¼Œç›´æ¥æ‹¦æˆªåœ¨é«˜é€Ÿç¼“å­˜é˜¶æ®µã€‚è¿™é‡Œï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨æ™®é€šçš„hash tableï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨bitmapï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼éƒ½æ¯”è¾ƒè€—è´¹å†…å­˜ï¼Œå½“é¢å¯¹æµ·é‡keyå€¼æ—¶ï¼Œé—®é¢˜ä¼šå˜å¾—æ›´åŠ ä¸¥é‡ã€‚è¿™æ—¶ï¼Œå°±è¯¥ä»‹ç»æˆ‘ä»¬çš„ä¸»è§’bloom filterå‡ºåœºäº†ã€‚
ä¸€èˆ¬çš„ï¼Œbloom filterç”¨äºåˆ¤æ–­ä¸€ä¸ªkeyå€¼æ˜¯å¦åœ¨ä¸€ä¸ªsetä¸­ï¼Œæ‹¥æœ‰æ¯”hash table/bitmapæ›´å¥½çš„ç©ºé—´ç»æµæ€§ã€‚å¦‚æœbloom filteræŒ‡ç¤ºä¸€ä¸ªkeyå€¼â€œä¸åœ¨â€ä¸€ä¸ªsetä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ¤æ–­æ˜¯100%å‡†ç¡®çš„ã€‚è¿™æ ·çš„ç‰¹æ€§ï¼Œéå¸¸é€‚åˆäºä¸Šè¿°çš„ç¼“å­˜åœºæ™¯ã€‚
bloom filteråŸç†   é¦–å…ˆä¼°è®¡è¦åˆ¤æ–­çš„setä¸­çš„å…ƒç´ ä¸ªæ•°Nï¼Œç„¶åé€‰å®škä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ã€‚æ ¹æ®Nå’Œkï¼Œé€‰å®šä¸€ä¸ªé•¿åº¦ä¸ºMçš„bit arrayã€‚
  éå†setä¸­çš„Nä¸ªå…ƒç´ 
 å¯¹æ¯ä¸ªå…ƒç´ ï¼Œä½¿ç”¨kä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°kä¸ªå“ˆå¸Œå€¼ï¼ˆä¸€èˆ¬ä¸ºä¸€ä¸ªå¤§æ•´æ•°ï¼‰ å°†ä¸Šè¿°bit arrayä¸­ï¼Œkä¸ªå“ˆå¸Œå€¼æ‰€å¯¹åº”çš„bitç½®1    å¯¹äºéœ€è¦åˆ¤æ–­çš„keyå€¼
 ä½¿ç”¨kä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°kä¸ªå“ˆå¸Œå€¼ å¦‚æœkä¸ªå“ˆå¸Œå€¼æ‰€å¯¹åº”çš„bit arrayä¸­çš„å€¼å‡ä¸º1ï¼Œåˆ™åˆ¤æ–­æ­¤å€¼åœ¨setä¸­â€œå¯èƒ½â€å­˜åœ¨ï¼›å¦åˆ™ï¼Œåˆ¤å®šâ€œä¸€å®šâ€ä¸å­˜åœ¨    æ ¹æ®ä¸Šé¢çš„åŸç†æˆ‘ä»¬å…¶å®å¯ä»¥çœ‹åˆ°ï¼Œbloom filteræœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
 æ¯”è¾ƒèŠ‚çœç©ºé—´ bloomçš„è¯†åˆ«å‡†ç¡®ç‡å’Œæ•°æ®å¤§å°ï¼Œkä¸ªå“ˆå¸Œå‡½æ•°æœ‰å…³ å¦‚æœbloom filteråˆ¤æ–­keyä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¸å­˜åœ¨ï¼Œ100%ä¸å­˜åœ¨ã€‚ å¦‚æœbloom filteråˆ¤æ–­keyå­˜åœ¨ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨  bloom filterä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š   æ’å…¥ã€æŸ¥æ‰¾éƒ½æ˜¯å¸¸æ•°æ—¶é—´
  å¤šä¸ªhashå‡½æ•°ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œå¯ä»¥å¹¶è¡Œè®¡ç®—
  ä¸éœ€è¦å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œä»è€Œå¸¦æ¥ç©ºé—´æ•ˆç‡ä¼˜åŠ¿ï¼Œä»¥åŠä¸€äº›ä¿å¯†ä¸Šçš„ä¼˜åŠ¿
  bloom filterçš„bitmapå¯ä»¥è¿›è¡Œäº¤ã€å¹¶ã€å·®è¿ç®—
  ç¼ºç‚¹ï¼š  åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­çš„ç»“æœå…¶å®æ˜¯ä¸å‡†ç¡®çš„ bloom filterä¸­çš„å…ƒç´ æ˜¯ä¸èƒ½åˆ é™¤çš„  bloom filterçš„å®é™…ä½¿ç”¨ guava bloom filter guavaä¸­æä¾›äº†bloom filterçš„ä¸€ç§å®ç°:com." />
    

    
    
    <meta name="keywords" content="JAVA, Spring, IOT, KAFKA, python, mysql" />
    

	

    <style type="text/css">
    </style>

    <link rel="shortcut icon" href="https://wenchao.ren/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://wenchao.ren/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://wenchao.ren/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://wenchao.ren/css/idea.css" />
    <script src="https://wenchao.ren/js/highlight.min.js"></script>
    <script src="https://wenchao.ren/js/highlightjs-line-numbers.min.js"></script>
    <script>hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
    </script>


    
    
</head>

<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://wenchao.ren">
                    <span>è¢«é—å¿˜çš„åšå®¢</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title"></p>
            <div class="my_socials">
                
                
                <a href="https://github.com/xkrivzooh" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://weibo.com/AnotherRobot/home" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                <a href="https://wenchao.ren/index.xml" type="application/rss+xml" title="rss" target="_blank"><i
                        class="ri-rss-fill"></i></a>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/bloom-filter/'>bloom filter</a></h2>
                    </div>
                    <div class="post_content markdown"><p>å½“ç³»ç»Ÿè®¾è®¡ä¸­å‡ºç°å¤šçº§ç¼“å­˜ç»“æ„æ—¶ï¼Œä¸ºäº†é˜²æ­¢å¤§é‡ä¸å­˜åœ¨çš„keyå€¼å‡»ç©¿é«˜é€Ÿç¼“å­˜ï¼ˆæ¯”å¦‚ä¸»å­˜ï¼‰ï¼Œå»ç›´æ¥è®¿é—®ä½é€Ÿç¼“å­˜ï¼ˆå¦‚æœ¬åœ°ç£ç›˜ï¼‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦å°†è¿™éƒ¨åˆ†keyå€¼ï¼Œç›´æ¥æ‹¦æˆªåœ¨é«˜é€Ÿç¼“å­˜é˜¶æ®µã€‚è¿™é‡Œï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨æ™®é€šçš„<code>hash table</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>bitmap</code>ï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼éƒ½æ¯”è¾ƒè€—è´¹å†…å­˜ï¼Œå½“é¢å¯¹æµ·é‡keyå€¼æ—¶ï¼Œé—®é¢˜ä¼šå˜å¾—æ›´åŠ ä¸¥é‡ã€‚è¿™æ—¶ï¼Œå°±è¯¥ä»‹ç»æˆ‘ä»¬çš„ä¸»è§’<code>bloom filter</code>å‡ºåœºäº†ã€‚</p>
<p>ä¸€èˆ¬çš„ï¼Œbloom filterç”¨äºåˆ¤æ–­ä¸€ä¸ªkeyå€¼æ˜¯å¦åœ¨ä¸€ä¸ªsetä¸­ï¼Œæ‹¥æœ‰æ¯”hash table/bitmapæ›´å¥½çš„ç©ºé—´ç»æµæ€§ã€‚å¦‚æœbloom filteræŒ‡ç¤ºä¸€ä¸ªkeyå€¼â€œä¸åœ¨â€ä¸€ä¸ªsetä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ¤æ–­æ˜¯100%å‡†ç¡®çš„ã€‚è¿™æ ·çš„ç‰¹æ€§ï¼Œéå¸¸é€‚åˆäºä¸Šè¿°çš„ç¼“å­˜åœºæ™¯ã€‚</p>
<h2 id="bloom-filteråŸç†">bloom filteråŸç†</h2>
<ul>
<li>
<p>é¦–å…ˆä¼°è®¡è¦åˆ¤æ–­çš„setä¸­çš„å…ƒç´ ä¸ªæ•°Nï¼Œç„¶åé€‰å®škä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ã€‚æ ¹æ®Nå’Œkï¼Œé€‰å®šä¸€ä¸ªé•¿åº¦ä¸ºMçš„bit arrayã€‚</p>
</li>
<li>
<p>éå†setä¸­çš„Nä¸ªå…ƒç´ </p>
<ul>
<li>å¯¹æ¯ä¸ªå…ƒç´ ï¼Œä½¿ç”¨kä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°kä¸ªå“ˆå¸Œå€¼ï¼ˆä¸€èˆ¬ä¸ºä¸€ä¸ªå¤§æ•´æ•°ï¼‰</li>
<li>å°†ä¸Šè¿°bit arrayä¸­ï¼Œkä¸ªå“ˆå¸Œå€¼æ‰€å¯¹åº”çš„bitç½®1</li>
</ul>
</li>
<li>
<p>å¯¹äºéœ€è¦åˆ¤æ–­çš„keyå€¼</p>
<ul>
<li>ä½¿ç”¨kä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°kä¸ªå“ˆå¸Œå€¼</li>
<li>å¦‚æœkä¸ªå“ˆå¸Œå€¼æ‰€å¯¹åº”çš„bit arrayä¸­çš„å€¼å‡ä¸º1ï¼Œåˆ™åˆ¤æ–­æ­¤å€¼åœ¨setä¸­â€œå¯èƒ½â€å­˜åœ¨ï¼›å¦åˆ™ï¼Œåˆ¤å®šâ€œä¸€å®šâ€ä¸å­˜åœ¨</li>
</ul>
</li>
</ul>
<p>æ ¹æ®ä¸Šé¢çš„åŸç†æˆ‘ä»¬å…¶å®å¯ä»¥çœ‹åˆ°ï¼Œbloom filteræœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ¯”è¾ƒèŠ‚çœç©ºé—´</li>
<li>bloomçš„è¯†åˆ«å‡†ç¡®ç‡å’Œæ•°æ®å¤§å°ï¼Œkä¸ªå“ˆå¸Œå‡½æ•°æœ‰å…³</li>
<li>å¦‚æœbloom filteråˆ¤æ–­keyä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¸å­˜åœ¨ï¼Œ100%ä¸å­˜åœ¨ã€‚</li>
<li>å¦‚æœbloom filteråˆ¤æ–­keyå­˜åœ¨ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨</li>
</ul>
<h2 id="bloom-filterä¼˜ç¼ºç‚¹">bloom filterä¼˜ç¼ºç‚¹</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹ï¼š</h3>
<ul>
<li>
<p>æ’å…¥ã€æŸ¥æ‰¾éƒ½æ˜¯å¸¸æ•°æ—¶é—´</p>
</li>
<li>
<p>å¤šä¸ªhashå‡½æ•°ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œå¯ä»¥å¹¶è¡Œè®¡ç®—</p>
</li>
<li>
<p>ä¸éœ€è¦å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œä»è€Œå¸¦æ¥ç©ºé—´æ•ˆç‡ä¼˜åŠ¿ï¼Œä»¥åŠä¸€äº›ä¿å¯†ä¸Šçš„ä¼˜åŠ¿</p>
</li>
<li>
<p>bloom filterçš„bitmapå¯ä»¥è¿›è¡Œäº¤ã€å¹¶ã€å·®è¿ç®—</p>
</li>
</ul>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹ï¼š</h3>
<ul>
<li>åˆ¤æ–­<code>å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</code>çš„ç»“æœå…¶å®æ˜¯ä¸å‡†ç¡®çš„</li>
<li>bloom filterä¸­çš„å…ƒç´ æ˜¯ä¸èƒ½åˆ é™¤çš„</li>
</ul>
<h2 id="bloom-filterçš„å®é™…ä½¿ç”¨">bloom filterçš„å®é™…ä½¿ç”¨</h2>
<h3 id="guava-bloom-filter">guava bloom filter</h3>
<p>guavaä¸­æä¾›äº†bloom filterçš„ä¸€ç§å®ç°:<code>com.google.common.hash.BloomFilter</code>ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬åœ¨å•æœºæƒ…å†µä¸‹ä½¿ç”¨bloom filterã€‚</p>
<pre><code class="language-java">/**
 * A Bloom filter for instances of {@code T}. A Bloom filter offers an approximate containment test
 * with one-sided error: if it claims that an element is contained in it, this might be in error,
 * but if it claims that an element is &lt;i&gt;not&lt;/i&gt; contained in it, then this is definitely true.
 *
 * &lt;p&gt;If you are unfamiliar with Bloom filters, this nice
 * &lt;a href=&quot;http://llimllib.github.com/bloomfilter-tutorial/&quot;&gt;tutorial&lt;/a&gt; may help you understand
 * how they work.
 *
 * &lt;p&gt;The false positive probability ({@code FPP}) of a bloom filter is defined as the probability
 * that {@linkplain #mightContain(Object)} will erroneously return {@code true} for an object that
 * has not actually been put in the {@code BloomFilter}.
 *
 * &lt;p&gt;Bloom filters are serializable. They also support a more compact serial representation via the
 * {@link #writeTo} and {@link #readFrom} methods. Both serialized forms will continue to be
 * supported by future versions of this library. However, serial forms generated by newer versions
 * of the code may not be readable by older versions of the code (e.g., a serialized bloom filter
 * generated today may &lt;i&gt;not&lt;/i&gt; be readable by a binary that was compiled 6 months ago).
 *
 * @param &lt;T&gt; the type of instances that the {@code BloomFilter} accepts
 * @author Dimitris Andreou
 * @author Kevin Bourrillion
 * @since 11.0
 */
@Beta
public final class BloomFilter&lt;T&gt; implements Predicate&lt;T&gt;, Serializable {

  /** The bit set of the BloomFilter (not necessarily power of 2!) */
  private final BitArray bits;

  /** Number of hashes per element */
  private final int numHashFunctions;

  /** The funnel to translate Ts to bytes */
  private final Funnel&lt;? super T&gt; funnel;

  /**
   * The strategy we employ to map an element T to {@code numHashFunctions} bit indexes.
   */
  private final Strategy strategy;

  /**
   * Creates a BloomFilter.
   */
  private BloomFilter(
      BitArray bits, int numHashFunctions, Funnel&lt;? super T&gt; funnel, Strategy strategy) {
    checkArgument(numHashFunctions &gt; 0, &quot;numHashFunctions (%s) must be &gt; 0&quot;, numHashFunctions);
    checkArgument(
        numHashFunctions &lt;= 255, &quot;numHashFunctions (%s) must be &lt;= 255&quot;, numHashFunctions);
    this.bits = checkNotNull(bits);
    this.numHashFunctions = numHashFunctions;
    this.funnel = checkNotNull(funnel);
    this.strategy = checkNotNull(strategy);
  }
  
  
  /**
   * Creates a {@link BloomFilter BloomFilter&lt;T&gt;} with the expected number of insertions and
   * expected false positive probability.
   *
   * &lt;p&gt;Note that overflowing a {@code BloomFilter} with significantly more elements than specified,
   * will result in its saturation, and a sharp deterioration of its false positive probability.
   *
   * &lt;p&gt;The constructed {@code BloomFilter&lt;T&gt;} will be serializable if the provided
   * {@code Funnel&lt;T&gt;} is.
   *
   * &lt;p&gt;It is recommended that the funnel be implemented as a Java enum. This has the benefit of
   * ensuring proper serialization and deserialization, which is important since {@link #equals}
   * also relies on object identity of funnels.
   *
   * @param funnel the funnel of T's that the constructed {@code BloomFilter&lt;T&gt;} will use
   * @param expectedInsertions the number of expected insertions to the constructed
   *     {@code BloomFilter&lt;T&gt;}; must be positive
   * @param fpp the desired false positive probability (must be positive and less than 1.0)
   * @return a {@code BloomFilter}
   */
  public static &lt;T&gt; BloomFilter&lt;T&gt; create(
      Funnel&lt;? super T&gt; funnel, int expectedInsertions, double fpp) {
    return create(funnel, (long) expectedInsertions, fpp);
  }

  /**
   * Creates a {@link BloomFilter BloomFilter&lt;T&gt;} with the expected number of insertions and
   * expected false positive probability.
   *
   * &lt;p&gt;Note that overflowing a {@code BloomFilter} with significantly more elements than specified,
   * will result in its saturation, and a sharp deterioration of its false positive probability.
   *
   * &lt;p&gt;The constructed {@code BloomFilter&lt;T&gt;} will be serializable if the provided
   * {@code Funnel&lt;T&gt;} is.
   *
   * &lt;p&gt;It is recommended that the funnel be implemented as a Java enum. This has the benefit of
   * ensuring proper serialization and deserialization, which is important since {@link #equals}
   * also relies on object identity of funnels.
   *
   * @param funnel the funnel of T's that the constructed {@code BloomFilter&lt;T&gt;} will use
   * @param expectedInsertions the number of expected insertions to the constructed
   *     {@code BloomFilter&lt;T&gt;}; must be positive
   * @param fpp the desired false positive probability (must be positive and less than 1.0)
   * @return a {@code BloomFilter}
   * @since 19.0
   */
  public static &lt;T&gt; BloomFilter&lt;T&gt; create(
      Funnel&lt;? super T&gt; funnel, long expectedInsertions, double fpp) {
    return create(funnel, expectedInsertions, fpp, BloomFilterStrategies.MURMUR128_MITZ_64);
  }

  @VisibleForTesting
  static &lt;T&gt; BloomFilter&lt;T&gt; create(
      Funnel&lt;? super T&gt; funnel, long expectedInsertions, double fpp, Strategy strategy) {
    checkNotNull(funnel);
    checkArgument(
        expectedInsertions &gt;= 0, &quot;Expected insertions (%s) must be &gt;= 0&quot;, expectedInsertions);
    checkArgument(fpp &gt; 0.0, &quot;False positive probability (%s) must be &gt; 0.0&quot;, fpp);
    checkArgument(fpp &lt; 1.0, &quot;False positive probability (%s) must be &lt; 1.0&quot;, fpp);
    checkNotNull(strategy);

    if (expectedInsertions == 0) {
      expectedInsertions = 1;
    }
    /*
     * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size
     * is proportional to -log(p), but there is not much of a point after all, e.g.
     * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!
     */
    long numBits = optimalNumOfBits(expectedInsertions, fpp);
    int numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, numBits);
    try {
      return new BloomFilter&lt;T&gt;(new BitArray(numBits), numHashFunctions, funnel, strategy);
    } catch (IllegalArgumentException e) {
      throw new IllegalArgumentException(&quot;Could not create BloomFilter of &quot; + numBits + &quot; bits&quot;, e);
    }
  }

  /**
   * Creates a {@link BloomFilter BloomFilter&lt;T&gt;} with the expected number of insertions and a
   * default expected false positive probability of 3%.
   *
   * &lt;p&gt;Note that overflowing a {@code BloomFilter} with significantly more elements than specified,
   * will result in its saturation, and a sharp deterioration of its false positive probability.
   *
   * &lt;p&gt;The constructed {@code BloomFilter&lt;T&gt;} will be serializable if the provided
   * {@code Funnel&lt;T&gt;} is.
   *
   * &lt;p&gt;It is recommended that the funnel be implemented as a Java enum. This has the benefit of
   * ensuring proper serialization and deserialization, which is important since {@link #equals}
   * also relies on object identity of funnels.
   *
   * @param funnel the funnel of T's that the constructed {@code BloomFilter&lt;T&gt;} will use
   * @param expectedInsertions the number of expected insertions to the constructed
   *     {@code BloomFilter&lt;T&gt;}; must be positive
   * @return a {@code BloomFilter}
   */
  public static &lt;T&gt; BloomFilter&lt;T&gt; create(Funnel&lt;? super T&gt; funnel, int expectedInsertions) {
    return create(funnel, (long) expectedInsertions);
  }

  /**
   * Creates a {@link BloomFilter BloomFilter&lt;T&gt;} with the expected number of insertions and a
   * default expected false positive probability of 3%.
   *
   * &lt;p&gt;Note that overflowing a {@code BloomFilter} with significantly more elements than specified,
   * will result in its saturation, and a sharp deterioration of its false positive probability.
   *
   * &lt;p&gt;The constructed {@code BloomFilter&lt;T&gt;} will be serializable if the provided
   * {@code Funnel&lt;T&gt;} is.
   *
   * &lt;p&gt;It is recommended that the funnel be implemented as a Java enum. This has the benefit of
   * ensuring proper serialization and deserialization, which is important since {@link #equals}
   * also relies on object identity of funnels.
   *
   * @param funnel the funnel of T's that the constructed {@code BloomFilter&lt;T&gt;} will use
   * @param expectedInsertions the number of expected insertions to the constructed
   *     {@code BloomFilter&lt;T&gt;}; must be positive
   * @return a {@code BloomFilter}
   * @since 19.0
   */
  public static &lt;T&gt; BloomFilter&lt;T&gt; create(Funnel&lt;? super T&gt; funnel, long expectedInsertions) {
    return create(funnel, expectedInsertions, 0.03); // FYI, for 3%, we always get 5 hash functions
  }

// other codes ...
}
</code></pre>
<p>åŸºæœ¬ä½¿ç”¨ï¼š</p>
<pre><code class="language-java">BloomFilter&lt;Integer&gt; filter = BloomFilter.create(Funnels.integerFunnel(),500,0.01);

filter.put(1);
filter.put(2);
filter.put(3);

assertThat(filter.mightContain(1)).isTrue();
assertThat(filter.mightContain(2)).isTrue();
assertThat(filter.mightContain(3)).isTrue();
assertThat(filter.mightContain(100)).isFalse();
</code></pre>
<p>æ­£ç¡®ä¼°è®¡é¢„æœŸæ’å…¥æ•°é‡æ˜¯å¾ˆå…³é”®çš„ä¸€ä¸ªå‚æ•°ã€‚å½“æ’å…¥çš„æ•°é‡æ¥è¿‘æˆ–é«˜äºé¢„æœŸå€¼çš„æ—¶å€™ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å°†ä¼šå¡«æ»¡ï¼Œè¿™æ ·çš„è¯ï¼Œå®ƒä¼šäº§ç”Ÿå¾ˆå¤šæ— ç”¨çš„è¯¯æŠ¥ç‚¹ã€‚</p>
<p>ä¸è¿‡ä¹Ÿæœ‰æ–‡ç« æŒ‡å‡ºï¼Œguavaçš„bloom filteråœ¨æ•°æ®é‡å˜å¤§ä»¥åï¼Œå‡†ç¡®æ€§å¤§å¤§é™ä½ï¼Œè¿™ä¸ªè™½ç„¶æœ¬èº«å°±æ˜¯bloom filterçš„ç‰¹æ€§ï¼Œä½†æ˜¯åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¹Ÿç»™å‡ºäº†ä¸€äº›å‚è€ƒå€¼ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹: <a href="https://blog.csdn.net/inte_sleeper/article/details/11687707">google guava bloom filteråŒ…çš„å‘</a> :</p>
<blockquote>
<p>åœ¨0.0001çš„é”™è¯¯ç‡ä¸‹ï¼Œæ’å…¥é‡ä¸åˆ°1.5äº¿çš„æ—¶å€™ï¼ŒnumBitså·²ç»åˆ°è¾¾äº†BitArrayçš„æœ€å¤§å®¹é‡äº†ï¼Œè¿™æ—¶å¦‚æœå†å¢åŠ æ’å…¥é‡ï¼Œå“ˆå¸Œå‡½æ•°ä¸ªæ•°å°±å¼€å§‹é€€åŒ–ã€‚åˆ°5äº¿çš„æ—¶å€™ï¼Œå“ˆå¸Œå‡½æ•°ä¸ªæ•°é€€åŒ–åˆ°äº†åªæœ‰3ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹æ¯ä¸€ä¸ªkeyï¼Œåªæœ‰3ä½æ¥æ ‡è¯†ï¼Œè¿™æ—¶å‡†ç¡®ç‡å°±ä¼šå¤§å¤§ä¸‹é™ã€‚
ç¬¬ä¸€ç§å½“ç„¶å°±æ˜¯å‡å°‘é¢„æœŸæ’å…¥é‡ï¼Œ1äº¿ä»¥å†…ï¼Œè¿˜æ˜¯å¯ä»¥ä¿è¯ç†è®ºä¸Šçš„å‡†ç¡®ç‡çš„ã€‚
ç¬¬äºŒç§ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿå¾ˆå¤§ï¼Œå°±æ˜¯ä¼šæœ‰ä¸Šäº¿çš„keyï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘æ‹†åˆ†ï¼Œå°†ä¸€ä¸ªå¤§çš„bloom filteræ‹†åˆ†æˆå‡ åä¸ªå°çš„ï¼ˆæ¯”å¦‚32æˆ–64ä¸ªï¼‰ï¼Œæ¯ä¸ªæœ€å¤šå¯ä»¥å®¹çº³1äº¿ï¼Œè¿™æ—¶æ•´ä½“å°±èƒ½å®¹çº³32æˆ–64äº¿çš„keyäº†ã€‚æŸ¥è¯¢çš„æ—¶å€™ï¼Œå…ˆå¯¹keyè®¡ç®—ä¸€æ¬¡å“ˆå¸Œï¼Œç„¶åå–æ¨¡ï¼ŒæŸ¥æ‰¾ç‰¹å®šçš„bloom filterå³å¯ã€‚</p>
</blockquote>
<h3 id="åŸºäºredisçš„bloom-filter">åŸºäºredisçš„bloom filter</h3>
<p>guavaä¸­çš„bloom filteræ˜¯å•æœºçš„ï¼Œå¦‚æœæƒ³ä½¿ç”¨åˆ†å¸ƒå¼çš„çš„è¯ï¼Œå¯ä»¥è€ƒè™‘åŸºäºredis çš„bloom filterã€‚</p>
<p>ä¸»è¦å‚è€ƒè¿™ä¸ªæ–‡ç« ï¼š<a href="https://redislabs.com/blog/rebloom-bloom-filter-datatype-redis/">ReBloom â€“ Bloom Filter Datatype for Redis</a></p>
<p>redis åœ¨ 4.0 çš„ç‰ˆæœ¬ä¸­åŠ å…¥äº† module åŠŸèƒ½ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥é€šè¿‡moduleçš„å½¢å¼æ·»åŠ åˆ° redis ä¸­ï¼Œæ‰€ä»¥ä½¿ç”¨ redis 4.0 ä»¥ä¸Šçš„ç‰ˆæœ¬å¯ä»¥é€šè¿‡åŠ è½½ module æ¥ä½¿ç”¨ redis ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚ä½†æ˜¯è¿™ä¸æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œä½¿ç”¨ docker å¯ä»¥ç›´æ¥åœ¨ redis ä¸­ä½“éªŒå¸ƒéš†è¿‡æ»¤å™¨ã€‚</p>
<pre><code class="language-shell">&gt; docker run -d -p 6379:6379 --name bloomfilter redislabs/rebloom
&gt; docker exec -it bloomfilter redis-cli
</code></pre>
<p>redis å¸ƒéš†è¿‡æ»¤å™¨ä¸»è¦å°±ä¸¤ä¸ªå‘½ä»¤ï¼š</p>
<ul>
<li><code>bf.add</code> æ·»åŠ å…ƒç´ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼š<code>bf.add urls https://jaychen.cc</code></li>
<li><code>bf.exists</code> åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨è¿‡æ»¤å™¨ä¸­ï¼š<code>bf.exists urls https://jaychen.cc</code></li>
</ul>
<p>ä¸Šé¢è¯´è¿‡å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µï¼Œåœ¨ redis ä¸­æœ‰ä¸¤ä¸ªå€¼å†³å®šå¸ƒéš†è¿‡æ»¤å™¨çš„å‡†ç¡®ç‡ï¼š</p>
<ul>
<li><code>error_rate</code>ï¼šå…è®¸å¸ƒéš†è¿‡æ»¤å™¨çš„é”™è¯¯ç‡ï¼Œè¿™ä¸ªå€¼è¶Šä½è¿‡æ»¤å™¨çš„ä½æ•°ç»„çš„å¤§å°è¶Šå¤§ï¼Œå ç”¨ç©ºé—´ä¹Ÿå°±è¶Šå¤§ã€‚</li>
<li><code>initial_size</code>ï¼šå¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥å‚¨å­˜çš„å…ƒç´ ä¸ªæ•°ï¼Œå½“å®é™…å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡è¿™ä¸ªå€¼ä¹‹åï¼Œè¿‡æ»¤å™¨çš„å‡†ç¡®ç‡ä¼šä¸‹é™ã€‚</li>
</ul>
<p>redis ä¸­æœ‰ä¸€ä¸ªå‘½ä»¤å¯ä»¥æ¥è®¾ç½®è¿™ä¸¤ä¸ªå€¼ï¼š</p>
<pre><code class="language-shell">bf.reserve urls 0.01 100
</code></pre>
<p>ä¸Šé¢ä¸‰ä¸ªå‚æ•°çš„å«ä¹‰ä¸ºï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå€¼æ˜¯è¿‡æ»¤å™¨çš„åå­—ã€‚</li>
<li>ç¬¬äºŒä¸ªå€¼ä¸º <code>error_rate</code> çš„å€¼ã€‚</li>
<li>ç¬¬ä¸‰ä¸ªå€¼ä¸º <code>initial_size</code> çš„å€¼ã€‚</li>
</ul>
<p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¦æ³¨æ„ä¸€ç‚¹ï¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹å‰è¿‡æ»¤å™¨çš„åå­—åº”è¯¥ä¸å­˜åœ¨ï¼Œå¦‚æœæ‰§è¡Œä¹‹å‰å°±å­˜åœ¨ä¼šæŠ¥é”™ï¼š<code>(error) ERR item exists</code></p>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« ï¼š</h2>
<ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIzODQyNjE1NA==&amp;mid=2247484087&amp;idx=1&amp;sn=d589f49e23da6787058e6df2c1cf2826&amp;chksm=e938c3f2de4f4ae4639bc58701aadf31f1bdd6ca959654da0c5ec55378bd2be9ffe4d9c72a2b&amp;scene=21#wechat_redirect">Cardinality Estimation</a></li>
<li><a href="https://blog.csdn.net/inte_sleeper/article/details/11687707">google guava bloom filteråŒ…çš„å‘</a></li>
<li><a href="https://redislabs.com/blog/rebloom-bloom-filter-datatype-redis/">ReBloom â€“ Bloom Filter Datatype for Redis</a></li>
</ul>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://wenchao.ren/tags/java/">java</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                <div class="doc_comments"><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "rollenholt" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span></span>
    </div>
</footer>
    <script src="https://wenchao.ren/js/jquery-3.5.1.min.js"></script>
<link href="https://wenchao.ren/css/fancybox.min.css" rel="stylesheet">
<script src="https://wenchao.ren/js/fancybox.min.js"></script>
<script src="https://wenchao.ren/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



</body>

</html>