<!DOCTYPE html>
<html lang="zh-cn" >
<head>
	<meta name="generator" content="Hugo 0.76.5" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="" />
	
	
	
	<title>被遗忘的博客  </title>
	
    
    
    <meta name="description" content="被遗忘的博客" />
    

    
    
    <meta name="keywords" content="JAVA, Spring, IOT, KAFKA, python, mysql" />
    

	
	<link rel="alternate" type="application/rss+xml" href="https://wenchao.ren/index.xml" title="被遗忘的博客" />
    

    <style type="text/css">
    </style>

    <link rel="shortcut icon" href="https://wenchao.ren/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://wenchao.ren/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://wenchao.ren/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://wenchao.ren/css/idea.css" />
    <script src="https://wenchao.ren/js/highlight.min.js"></script>
    <script src="https://wenchao.ren/js/highlightjs-line-numbers.min.js"></script>
    <script>hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
    </script>


    
    
</head>

<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://wenchao.ren">
                    <span>被遗忘的博客</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title"></p>
            <div class="my_socials">
                
                
                <a href="https://github.com/xkrivzooh" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://weibo.com/AnotherRobot/home" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                <a href="https://wenchao.ren/index.xml" type="application/rss+xml" title="rss" target="_blank"><i
                        class="ri-rss-fill"></i></a>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/js%E9%81%BF%E5%85%8D%E5%BF%AB%E9%80%9F%E7%82%B9%E5%87%BB/'>js避免快速点击</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>通过JavaScript避免按钮快速被点击，有一般都是通过修改状态，然后延迟恢复状态来弄的，demo如下：
onRefresh: function () { $(&quot;button[name='refresh']&quot;).attr('disabled', true); $('#jar-debug-table').bootstrapTable('removeAll'); getAllClass(); setTimeout(function () { $(&quot;button[name='refresh']&quot;).attr('disabled', false); }, 3000); }  ......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.29</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/js/">js</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/%E5%85%B3%E4%BA%8Eelasticsearch%E7%9A%84access-log/'>关于elasticsearch的access log</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>今天才知道原来elasticsearch其实并没有传统意义上的access log。我这里说的传统意义 上的access log是指类似于tomcat，nginx等的access log。 我们公司在访问elasticsearch的时候，java语言相关的使用的公司封装的（其实是我封装的） elasticsearch client，在这个封装的client里面，实现了传统意义上的类似于dubbo-consumer-access.log 一样的东西，记录了请求时间，traceId，请求的参数信息，请求是否成功的状态，响应时间，响应的内容等等 的信息。但是在elasticsearch的server端其实是并没有这些内容的。 Google了一下，发现elasticsearch其实并没有access log这个功能。但是elasticsearch缺提供了slow log的这个功能。 虽然说slow log和access log其实是两种不同的东西，但是在一定程度上slow log其实可以做到access log的一部分功能。
elasticsearch的slow log 这个日志的目的是捕获那些超过指定时间阈值的查询和索引请求。这个日志用来追踪由用户产生的很慢的请求很有用。 默认情况，慢日志是不开启的。要开启它，需要定义具体动作（query，fetch 还是 index），你期望的事件记录等级（ WARN 、 DEBUG 等），以及时间阈值。
query query阶段的配置，日志记录在_index_isearch_slowlog.log结尾的文件中，下面的日志级别可以根据实际 的需求来选择，如果想关闭某个配置的话，使用#号注释，或者设置值为-1就行。当然需要重启elasticsearch 以使得配置修改生效。
 index.search.slowlog.threshold.query.warn: 10s #超过10秒的query产生1个warn日志 index.search.slowlog.threshold.query.info: 5s #超过5秒的query产生1个info日志 index.search.slowlog.threshold.query.debug: 2s #超过2秒的query产生1个debug日志 index.search.slowlog.threshold.query.trace: 500ms #超过500毫秒的query产生1个trace日志  fetch fetch阶段的配置
 index.search.slowlog.threshold.fetch.warn: 1s index.search.slowlog.threshold.fetch.info: 800ms index.search.slowlog.threshold.fetch.debug: 500ms index.search.slowlog.threshold.fetch.trace: 200ms  index 索引阶段的配置
 index.indexing.slowlog.threshold.index.warn: 10s ##索引数据超过10秒产生一个warn日志 index.indexing.slowlog.threshold.index.info: 5s ##索引数据超过5秒产生一个info日志 index.indexing.slowlog.threshold.index.debug: 2s ##索引数据超过2秒产生一个ddebug日志 index.......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.09</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/es/">es</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/dubbo-xml%E8%A7%A3%E6%9E%90/'>dubbo xml解析</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>在之前的文章《如何在spring中自定义xml标签并解析》中我用实际的例子展示了，如何在spring中自定义xml标签，同时如何解析这个xml标签。
本篇文章主要来看看dubbo中对应的源代码
如上图所示，这些类就是dubbo解析xml的相关实现的核心类，核心原理已经在之前的文章中详细描述了，如果大家在阅读dubbo代码，想看某个element的解析类的话，可以在DubboNamespaceHandler中来找：
public class DubboNamespaceHandler extends NamespaceHandlerSupport { static { Version.checkDuplicate(DubboNamespaceHandler.class); } @Override public void init() { registerBeanDefinitionParser(&quot;application&quot;, new DubboBeanDefinitionParser(ApplicationConfig.class, true)); registerBeanDefinitionParser(&quot;module&quot;, new DubboBeanDefinitionParser(ModuleConfig.class, true)); registerBeanDefinitionParser(&quot;registry&quot;, new DubboBeanDefinitionParser(RegistryConfig.class, true)); registerBeanDefinitionParser(&quot;config-center&quot;, new DubboBeanDefinitionParser(ConfigCenterBean.class, true)); registerBeanDefinitionParser(&quot;metadata-report&quot;, new DubboBeanDefinitionParser(MetadataReportConfig.class, true)); registerBeanDefinitionParser(&quot;monitor&quot;, new DubboBeanDefinitionParser(MonitorConfig.class, true)); registerBeanDefinitionParser(&quot;metrics&quot;, new DubboBeanDefinitionParser(MetricsConfig.class, true)); registerBeanDefinitionParser(&quot;provider&quot;, new DubboBeanDefinitionParser(ProviderConfig.class, true)); registerBeanDefinitionParser(&quot;consumer&quot;, new DubboBeanDefinitionParser(ConsumerConfig.class, true)); registerBeanDefinitionParser(&quot;protocol&quot;, new DubboBeanDefinitionParser(ProtocolConfig.class, true)); registerBeanDefinitionParser(&quot;service&quot;, new DubboBeanDefinitionParser(ServiceBean.class, true)); registerBeanDefinitionParser(&quot;reference&quot;, new DubboBeanDefinitionParser(ReferenceBean.class, false)); registerBeanDefinitionParser(&quot;annotation&quot;, new AnnotationBeanDefinitionParser()); } }  基本上就是一个xml element对应一个BeanDefinitionParser......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.08</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/dubbo/">dubbo</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/%E5%A6%82%E4%BD%95%E5%9C%A8spring%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89xml%E6%A0%87%E7%AD%BE%E5%B9%B6%E8%A7%A3%E6%9E%90/'>如何在spring中自定义xml标签并解析</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>如果大家使用过dubbo那么大概率看见过&lt;dubbo:application ...&gt;类似的配置。这其实就是一种xml标签的自定义，当然dubbo的实现中也会有自己的解析。
这篇文章主要就说一下xml标签的自定义和解析。本篇文章中的代码仓库地址为：https://github.com/xkrivzooh/spring-define-and-parse-example
大家按照上面的demo例子跑一下就会明白完整流程。其中有一些注意点我列了一下：
 .xsd文件中的targetNamespace定义了以后，后续其他的比如xmlns的值，spring.handlers以及spring.schemas中的值需要对应上 xsd:element定义的就是将来会在xml文件中用到的元素，例如&lt;dubbo:application&gt;中的application xsd:attribute定义的就是模型类中的属性，例如&lt;dubbo:application name=&quot;xxx&quot;&gt;中的name，并且可以指定属性类型，进而起到检测的作用（当我们定义的是int，如果在xml中的值是非int型的，直接会报错）。 通常为每一个xsd:element都要注册一个BeanDefinitionParser。 person-demo.xml中的&lt;AnyStringYouWant:person name=&quot;name1&quot; age=&quot;1&quot;/&gt;中的AnyStringYouWant你可以随意替换  ......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.08</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/java/">java</a>
                    
                    <a href="https://wenchao.ren/tags/spring/">spring</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/dubbo-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/'>dubbo 线程模型</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>dubbo的线程模型设计的算是非常不错的了，值得我们学习。下图是dubbo的线程模型图：
IO线程和业务线程的选择原则 在官方文档中，对于线程模型的选择说的比较清楚：
 如果事件处理的逻辑能迅速完成，并且不会发起新的 IO 请求，比如只是在内存中记个标识，则直接在 IO 线程上处理更快，因为减少了线程池调度。 但如果事件处理逻辑较慢，或者需要发起新的 IO 请求，比如需要查询数据库，则必须派发到线程池，否则 IO 线程阻塞，将导致不能接收其它请求。如果用 IO 线程处理事件，又在事件处理过程中发起新的 IO 请求，比如在连接事件中发起登录请求，会报“可能引发死锁”异常，但不会真死锁。  我们平时在编写代码的时候，也需要遵循这个大原则。
dubbo的线程模型配置起来也是比较简单的：
&lt;dubbo:protocol name=&quot;dubbo&quot; dispatcher=&quot;all&quot; threadpool=&quot;fixed&quot; threads=&quot;100&quot; /&gt;  比如上面的配置中，dubbo协议使用了all Dispatcher，内部使用固定100大小的线程池。
根据上面的线程模型图来看，当dubbo provider收到dubbo consumer的请求以后，会通过Dispather模块来进行请求分发，在这个Dispather模块中决定了dubbo的部分功能使用哪个线程池。然后在ThreadPool模块中提供了好几个线程池实现。基本上算是覆盖到了绝大多数场景。
dubbo Dispatcher分类  all 所有消息都派发到线程池，包括请求，响应，连接事件，断开事件，心跳等。 direct 所有消息都不派发到线程池，全部在 IO 线程上直接执行。 message 只有请求响应消息派发到线程池，其它连接断开事件，心跳等消息，直接在 IO 线程上执行。 execution 只请求消息派发到线程池，不含响应，响应和其它连接断开事件，心跳等消息，直接在 IO 线程上执行。 connection 在 IO 线程上，将连接断开事件放入队列，有序逐个执行，其它消息派发到线程池。  默认情况下的dispatcher为all，这样的话可以尽可能的提示吞吐量。
dubbo的ThreadPool  fixed 固定大小线程池，启动时建立线程，不关闭，一直持有。(缺省) cached 缓存线程池，空闲一分钟自动删除，需要时重建。 limited 可伸缩线程池，但池中的线程数只会增长不会收缩。只增长不收缩的目的是为了避免收缩时突然来了大流量引起的性能问题。 eager 优先创建Worker线程池。在任务数量大于corePoolSize但是小于maximumPoolSize时，优先创建Worker来处理任务。当任务数量大于maximumPoolSize时，将任务放入阻塞队列中。阻塞队列充满时抛出RejectedExecutionException。(相比于cached:cached在任务数量超过maximumPoolSize时直接抛出异常而不是将任务放入阻塞队列)  从dispatcher和threadpool模块可以看出，dubbo之所以搞这么多dispatcher和threadpool的实现，就是基于线程模型的选择大原则，使得可以针对不同的业务场景，业务使用方可以自主选择不同的实现。从这一点上来说，作为一个rpc框架，dubbo在这方面的考量和实现算是非常不错的了。
源码阅读 dubbo的线程模型相关的代码，我们从org.apache.dubbo.remoting.transport.netty4.NettyServer这个类开始看，在NettyServer中：......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.07</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/dubbo/">dubbo</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/%E4%B8%8D%E8%A7%84%E8%8C%83%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%AF%BC%E8%87%B4elasticsearch-stackoverflowerror/'>不规范的查询导致elasticsearch StackOverflowError</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>昨天我们公司的elasticsearch的集群有几个节点出现了StackOverflowError，然后es进程退出的问题。最终排查发现导致es节点出现下面的异常：
[2019-08-05T20:31:35,367][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [order6] fatal error in thread [elasticsearch[order6][search][T#38]], exiting java.lang.StackOverflowError: null at org.apache.lucene.store.DataInput.readVLong(DataInput.java:184) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11] at org.apache.lucene.store.DataInput.readVLong(DataInput.java:169) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11] at org.apache.lucene.util.fst.FST.readUnpackedNodeTarget(FST.java:931) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11] at org.apache.lucene.util.fst.FST.readNextRealArc(FST.java:1143) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11] at org.apache.lucene.util.fst.FST.readFirstRealTargetArc(FST.java:992) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11] at org.apache.lucene.util.fst.FST.findTargetArc(FST.java:1270) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11] at org.apache.lucene.util.fst.FST.findTargetArc(FST.java:1186) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11] at org.......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.06</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/es/">es</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/java-%E5%B8%B8%E8%A7%81%E7%9A%84oom-case/'>java 常见的OOM case</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>OOM是java.lang.OutOfMemoryError异常的简称，在日常工作中oom还算是比较常见的一种问题吧。出现OOM意味着jvm已经无法满足新对象对内存的申请了，本文整理了一下oom的常见case和一般情况下的解决方法。
处理OOM问题，绝大多数情况下jmap和MAT工具可以解决99%的问题。
Java heap space 表现现象为：
java.lang.OutOfMemoryError: Java heap space  可能的原因  内存泄漏 堆大小设置不合理 JVM处理引用不及时，导致内存无法释放 代码中可能存在大对象分配  解决办法  一般情况下，都是先通过jmap命令，把堆内存dump下来，使用mat工具分析一下，检查是否因为代码问题，存在内存泄露 也可能是下游服务出问题，导致内存中的数据不能很快的处理掉，进而引起oom 调整-Xmx参数，加大堆内存 还有一点容易被忽略，检查是否有大量的自定义的 Finalizable 对象，也有可能是框架内部提供的，考虑其存在的必要性  PermGen space 永久代是HotSot虚拟机对方法区的具体实现，存放了被虚拟机加载的类信息、常量、静态变量、JIT编译后的代码等。
一般情况下的异常表现为：
java.lang. OutOfMemoryError : PermGen space  可能的原因  在Java7之前，频繁的错误使用String.intern()方法 运行期间生成了大量的代理类，导致方法区被撑爆，无法卸载  解决办法  检查是否永久代空间是否设置的过小 检查代码中是否存错误的创建过多的代理类  Metaspace JDK8后，元空间替换了永久带，元空间使用的是本地内存，还有其它细节变化：
 字符串常量由永久代转移到堆中 和永久代相关的JVM参数已移除  一般情况下的异常表现为：
java.lang.OutOfMemoryError: Metaspace  可能的原因 类似PermGen space
解决办法  通过命令行设置 -XX: MaxMetaSpaceSize 增加 metaspace 大小，或者取消-XX: maxmetsspacedize 其他类似PermGen space  unable to create new native Thread 这种情况的一般表现为：......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.06</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/java/">java</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/%E4%BD%BF%E7%94%A8maven-shade-plugin%E8%A7%A3%E5%86%B3%E4%BE%9D%E8%B5%96%E5%86%B2%E7%AA%81/'>使用maven-shade-plugin解决依赖冲突</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>一般遇到一些比较复杂恶心的依赖冲突，传统的通过dependencyManagement和exclusion有时候是解不了的。这种问题最常见的是netty相关的。 这种情况下我们可以使用maven-shade-plugin插件。
比如我这边的一个case是我们依赖的redisson需要4.1.36.Final的netty，而我们公司其他的组件必须依赖4.0.46.Final的netty，而这2个版本的netty 是不兼容的，因此我当时就使用了maven-shade-plugin插件来解决这个问题。
因为我们公司内部的netty都是4.0.46.Final，因此我专门搞了一个redisson-shade的maven module，这个module只有pom.xml文件，在这个module中我们依赖 redisson，然后将redisson内部依赖的netty的package路径进行修改, 然后其他的module通过依赖redisson-shade的maven module就好了。
pom.xml文件内容为:
&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt; &lt;version&gt;3.2.1&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;shade&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;relocations&gt; &lt;relocation&gt; &lt;pattern&gt;io.netty&lt;/pattern&gt; &lt;shadedPattern&gt;com.xxx.io.netty.redisson&lt;/shadedPattern&gt; &lt;/relocation&gt; &lt;/relocations&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;finalName&gt;redisson-shade&lt;/finalName&gt; &lt;/build&gt;  在上面的pom中，在package阶段，会把redisson依赖的netty的package路径从io.netty修改为com.xxx.io.netty.redisson。这样就解决了依赖冲突问题。
不过我是在同一个工程中搞多个maven module来弄的，因此本地测试时候，一般都需要专门搞一个测试工程，这个算是一个麻烦点。......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.01</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/java/">java</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/maven-scope%E4%BB%8B%E7%BB%8D/'>maven scope介绍</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>maven的scope有下面6种：
 test compile 默认scope runntime provided system import  下面我们分别说一下每个scope的含义
test scope为test表示依赖项目仅仅参与测试相关的工作，包括测试代码的编译，执行，test scope的依赖项不具有传递性，仅适用于测试和执行类路径。
一般像我们使用的junit的测试相关的jar都是使用test scope的，比如：
&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;  compile maven的scope默认就是compile，什么都不配置也就是意味着compile。compile表示被依赖项目需要参与当前项目的编译，当然后续的测试，运行周期也参与其中 ，是一个比较强的依赖。打包的时候通常需要包含进去，具有依赖传递性。
比如：
&lt;dependency&gt; &lt;groupId&gt;commons-lang&lt;/groupId&gt; &lt;artifactId&gt;commons-lang&lt;/artifactId&gt; &lt;version&gt;2.6&lt;/version&gt; &lt;/dependency&gt;  runntime runntime表示被依赖项目无需参与项目的编译，不过后期的测试和运行周期需要其参与。与compile相比，跳过编译而已，说实话在终端的项目（非开源，企业内部系统）中，和compile区别不是很大。compile只需要知道接口就足够了。mysql jdbc驱动架包就是一个很好的例子，一般scope为runntime。另外runntime的依赖通常和optional搭配使用，optional为true。我可以用A实现，也可以用B实现。
比较常见的mysql-connector-java一般就设置为runtime scope：
&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;6.0.6&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt;  provider provided意味着打包的时候可以不用包进去，别的设施(比如jdk或者其他的Web Container)会提供。事实上该依赖理论上可以参与编译，测试，运行等周期。相当于compile，但是在打包阶段做了exclude的动作。 provider scope的一个很好的用例是部署在某个容器（如tomcat）中的Web应用程序，其中容器本身已经提供了一些库。比如常见的servlet-api一般就是provider的：
&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;servlet-api&lt;/artifactId&gt; &lt;version&gt;2.5&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt;  system 从参与度来说，也provided相同，不过被依赖项不会从maven仓库抓，而是从本地文件系统拿，一定需要配合systemPath属性使用。需要记住的重要一点是，如果不存在依赖关系或者位于与systemPath指向的位置不同的位置，则在不同的计算机上构建具有系统范围依赖关系的项目可能会失败：
一个例子：
&lt;dependency&gt; &lt;groupId&gt;com.baeldung&lt;/groupId&gt; &lt;artifactId&gt;custom-dependency&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;scope&gt;system&lt;/scope&gt; &lt;systemPath&gt;${project.basedir}/libs/custom-dependency-1.3.2.jar&lt;/systemPath&gt; &lt;/dependency&gt;  import 此范围已在Maven 2.......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.08.01</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/java/">java</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>

<div class="post animated fadeInDown">
    <div class="post_title">
        <h2><a href='/posts/redis-pipeline/'>redis Pipeline</a></h2>
    </div>
    
    <div class="list">
        <div class="post_content markdown">
            <p>在基于request-response的请求模型中，一般都会涉及下面几个阶段：
 client发送命令 命令在网络上传输 server收到命令并开始执行 server返回结果  在这个过程中我们可以看到有2次网络传输，而这两次网络传输的耗时成为：RTT (Round Trip Time)。例如，如果 RTT 时间是250毫秒（网络连接很慢的情况下）， 即使服务端每秒能处理100k的请求量，那我们每秒最多也只能处理4个请求。如果使用的是本地环回接口，RTT 就短得多，但如如果需要连续执行多次写入，这也是一笔很大的开销。下面的图是传统的 N次request-response的交互图：
 一般情况下我们为了解决rtt耗时太长的问题，会采样批处理的解决方案，也就是将请求参数批量发给server端，server端处理完这些请求以后，在一次性返回结果。
 在redis中，已经提供了一些批量操作命令，比如mget，mset等命令。但是也有不少命令是没有批量操作命令的，但是为了解决这个问题，redis支持Pipeline。
Pipeline 并不是一种新的技术或机制，很多技术上都使用过。RTT 在不同网络环境下会不同，例如同机房和同机房会比较快，跨机房跨地区会比较慢。Redis 很早就支持 Pipeline 技术，因此无论你运行的是什么版本，你都可以使用 Pipeline 操作 Redis。如果客户端和服务端的网络延时越大，那么Pipeline的效果越明显。
Pipeline 能将一组 Redis 命令进行组装，通过一次 RTT 传输给 Redis，再将这组 Redis 命令按照顺序执行并将结果返回给客户端。上图没有使用 Pipeline 执行了 N 条命令，整个过程需要 N 次 RTT。下图为使用 Pipeline 执行 N 条命令，整个过程仅需要 1 次 RTT：
Pipeline 基本使用 我比较喜欢用的lettuce中对pipeline的使用方式（Asynchronous Pipelining）如下：
StatefulRedisConnection&lt;String, String&gt; connection = client.connect(); RedisAsyncCommands&lt;String, String&gt; commands = connection.async(); // disable auto-flushing commands.setAutoFlushCommands(false); // perform a series of independent calls List&lt;RedisFuture&lt;?......</p>
        </div>
    </div>
    
    <div class="post_footer">
        <div class="meta">
            <div class="info">
                <span class="field">
                    <i class="ri-map-pin-time-line"></i>
                    <span class="date">2019.07.31</span>
                </span>
                
                <span class="field tags">
                    <i class="ri-stack-line"></i>
                    
                    <a href="https://wenchao.ren/tags/redis/">redis</a>
                    
                </span>
                
            </div>
        </div>
    </div>
</div>


<div class="pagination">
    
    
    <a href="/page/3/" class="pre">
        Prev
    </a>
    
    
    <a href="/page/5/" class="next">
        Next
    </a>
    
    
</div>
        </div>
    </div>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span></span>
    </div>
</footer>
    <script src="https://wenchao.ren/js/jquery-3.5.1.min.js"></script>
<link href="https://wenchao.ren/css/fancybox.min.css" rel="stylesheet">
<script src="https://wenchao.ren/js/fancybox.min.js"></script>
<script src="https://wenchao.ren/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



</body>

</html>